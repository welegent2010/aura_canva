<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ·å¼åŠ è½½æµ‹è¯•</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f9fafb;
        }
        h1 {
            color: #111827;
        }
        .test-result {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .success {
            color: #059669;
            font-weight: 500;
        }
        .error {
            color: #dc2626;
            font-weight: 500;
        }
        .info {
            color: #3b82f6;
        }
        pre {
            background: #f3f4f6;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
        }
        .style-card {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
            background: #fafafa;
        }
        .style-card h3 {
            margin: 0 0 8px 0;
            color: #374151;
            font-size: 16px;
        }
        .style-card p {
            margin: 4px 0;
            font-size: 14px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <h1>ğŸ¨ æ ·å¼æ–‡ä»¶åŠ è½½æµ‹è¯•</h1>
    
    <div class="test-result">
        <h2>æµ‹è¯•çŠ¶æ€</h2>
        <p id="status">æ­£åœ¨åŠ è½½...</p>
    </div>

    <div class="test-result">
        <h2>Manifest.json å†…å®¹</h2>
        <pre id="manifest-content"></pre>
    </div>

    <div class="test-result">
        <h2>åŠ è½½çš„æ ·å¼åˆ—è¡¨</h2>
        <div id="styles-list"></div>
    </div>

    <div class="test-result">
        <h2>æ§åˆ¶å°æ—¥å¿—</h2>
        <pre id="console-log"></pre>
    </div>

    <script>
        const logs = [];
        
        // æ‹¦æˆªconsole.log
        const originalLog = console.log;
        console.log = function(...args) {
            logs.push(args.join(' '));
            originalLog.apply(console, args);
            updateConsoleLog();
        };

        const originalError = console.error;
        console.error = function(...args) {
            logs.push('ERROR: ' + args.join(' '));
            originalError.apply(console, args);
            updateConsoleLog();
        };

        function updateConsoleLog() {
            document.getElementById('console-log').textContent = logs.join('\n');
        }

        async function testStyleLoading() {
            try {
                // 1. åŠ è½½ manifest.json
                console.log('1. åŠ è½½ manifest.json...');
                const manifestResponse = await fetch('style/manifest.json');
                if (!manifestResponse.ok) {
                    throw new Error(`ManifeståŠ è½½å¤±è´¥: ${manifestResponse.status}`);
                }
                
                const styleFiles = await manifestResponse.json();
                console.log(`âœ“ ManifeståŠ è½½æˆåŠŸï¼ŒåŒ…å« ${styleFiles.length} ä¸ªæ ·å¼`);
                document.getElementById('manifest-content').textContent = 
                    JSON.stringify(styleFiles, null, 2);

                // 2. åŠ è½½æ¯ä¸ªæ ·å¼æ–‡ä»¶
                console.log('\n2. åŠ è½½æ ·å¼æ–‡ä»¶...');
                const loadedStyles = [];
                
                for (const styleInfo of styleFiles) {
                    try {
                        console.log(`  åŠ è½½ ${styleInfo.file}...`);
                        const response = await fetch(styleInfo.file);
                        
                        if (!response.ok) {
                            console.error(`  âœ— ${styleInfo.file} åŠ è½½å¤±è´¥: ${response.status}`);
                            continue;
                        }
                        
                        const styleSet = await response.json();
                        
                        // éªŒè¯å¿…è¦å­—æ®µ
                        if (!styleSet.id) {
                            styleSet.id = styleInfo.file.replace(/[\/\.]/g, '_');
                            console.log(`  âš  æœªæ‰¾åˆ°IDï¼Œä½¿ç”¨ç”Ÿæˆçš„ID: ${styleSet.id}`);
                        }
                        if (!styleSet.name) {
                            styleSet.name = styleInfo.name;
                            console.log(`  âš  æœªæ‰¾åˆ°nameï¼Œä½¿ç”¨manifestä¸­çš„name: ${styleSet.name}`);
                        }
                        
                        console.log(`  âœ“ ${styleSet.name} (ID: ${styleSet.id})`);
                        console.log(`    - cardStyleå­˜åœ¨: ${styleSet.cardStyle ? 'æ˜¯' : 'å¦'}`);
                        console.log(`    - gridå­˜åœ¨: ${styleSet.grid ? 'æ˜¯' : 'å¦'}`);
                        
                        loadedStyles.push(styleSet);
                    } catch (error) {
                        console.error(`  âœ— ${styleInfo.file} è§£æå¤±è´¥:`, error.message);
                    }
                }

                console.log(`\nâœ“ å…±æˆåŠŸåŠ è½½ ${loadedStyles.length} ä¸ªæ ·å¼`);
                
                // æ˜¾ç¤ºç»“æœ
                const statusEl = document.getElementById('status');
                if (loadedStyles.length === styleFiles.length) {
                    statusEl.innerHTML = `<span class="success">âœ“ å…¨éƒ¨æ ·å¼åŠ è½½æˆåŠŸï¼(${loadedStyles.length}/${styleFiles.length})</span>`;
                } else {
                    statusEl.innerHTML = `<span class="error">âš  éƒ¨åˆ†æ ·å¼åŠ è½½å¤±è´¥ (${loadedStyles.length}/${styleFiles.length})</span>`;
                }

                // æ˜¾ç¤ºæ ·å¼å¡ç‰‡
                const stylesListEl = document.getElementById('styles-list');
                if (loadedStyles.length === 0) {
                    stylesListEl.innerHTML = '<p class="error">æœªåŠ è½½ä»»ä½•æ ·å¼</p>';
                } else {
                    stylesListEl.innerHTML = loadedStyles.map(style => `
                        <div class="style-card">
                            <h3>${style.name}</h3>
                            <p><strong>ID:</strong> ${style.id}</p>
                            <p><strong>æè¿°:</strong> ${style.description || 'æ— '}</p>
                            <p><strong>cardStyle:</strong> ${style.cardStyle ? 'âœ“ å­˜åœ¨' : 'âœ— ç¼ºå¤±'}</p>
                            <p><strong>grid:</strong> ${style.grid ? `âœ“ ${style.grid.columns}åˆ—` : 'âœ— ç¼ºå¤±'}</p>
                        </div>
                    `).join('');
                }

            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                document.getElementById('status').innerHTML = 
                    `<span class="error">âœ— æµ‹è¯•å¤±è´¥: ${error.message}</span>`;
            }
        }

        // è¿è¡Œæµ‹è¯•
        testStyleLoading();
    </script>
</body>
</html>
