<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aura Canvas - Google Sheets + Grid</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: #333;
      margin-bottom: 30px;
    }

    .section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .section h2 {
      color: #555;
      margin-bottom: 15px;
      font-size: 1.2rem;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #666;
    }

    input[type="text"],
    input[type="number"],
    textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    textarea {
      font-family: monospace;
      min-height: 100px;
    }

    button {
      background: #4a90e2;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }

    button:hover {
      background: #357abd;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .output {
      background: #f8f8f8;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      margin-top: 15px;
      max-height: 400px;
      overflow-y: auto;
    }

    .output pre {
      margin: 0;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 13px;
      font-family: monospace;
    }

    .error {
      color: #e74c3c;
      background: #fee;
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
    }

    .success {
      color: #27ae60;
      background: #efe;
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
    }

    .preview {
      margin-top: 20px;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .grid-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    .range-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    input[type="range"] {
      flex: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Aura Canvas - 使用示例</h1>

    <div class="section">
      <h2>1. Google Sheets 数据加载</h2>
      <div class="form-group">
        <label for="sheetUrl">Google Sheets URL</label>
        <input type="text" id="sheetUrl" placeholder="https://docs.google.com/spreadsheets/d/..." value="">
      </div>
      <div class="form-group">
        <label for="sheetName">Sheet 名称 (可选，默认 Sheet1)</label>
        <input type="text" id="sheetName" placeholder="Sheet1" value="Sheet1">
      </div>
      <button id="loadSheetBtn">加载数据</button>
      <div id="sheetOutput" class="output">
        <pre>点击"加载数据"按钮开始加载 Google Sheets 数据...</pre>
      </div>
    </div>

    <div class="section">
      <h2>2. CSS Grid 生成器</h2>
      <div class="grid-controls">
        <div class="form-group">
          <label for="columns">列数: <span id="columnsValue">3</span></label>
          <input type="range" id="columns" min="1" max="6" value="3">
        </div>
        <div class="form-group">
          <label for="gap">间距: <span id="gapValue">24</span>px</label>
          <input type="range" id="gap" min="0" max="48" value="24" step="4">
        </div>
        <div class="form-group">
          <label for="minWidth">最小宽度: <span id="minWidthValue">300</span>px</label>
          <input type="range" id="minWidth" min="200" max="500" value="300" step="50">
        </div>
      </div>
      <button id="generateGridBtn">生成 Grid CSS</button>
      <button id="previewGridBtn">预览网格</button>
      <div id="gridOutput" class="output">
        <pre>调整参数后点击"生成 Grid CSS"查看结果...</pre>
      </div>
    </div>

    <div class="section">
      <h2>3. 完整预览</h2>
      <button id="generateCompleteBtn">生成完整 HTML</button>
      <button id="exportBtn">导出 HTML 文件</button>
      <div id="completeOutput" class="output">
        <pre>点击"生成完整 HTML"查看完整结果...</pre>
      </div>
    </div>

    <div id="previewArea" class="preview" style="display: none;">
      <h2>实时预览</h2>
      <div id="previewContent"></div>
    </div>
  </div>

  <script src="js/sheets.js"></script>
  <script src="js/grid.js"></script>
  <script>
    let sheetData = null;
    const connector = new GoogleSheetsConnector();
    const grid = new GridGenerator();

    const sheetUrlInput = document.getElementById('sheetUrl');
    const sheetNameInput = document.getElementById('sheetName');
    const loadSheetBtn = document.getElementById('loadSheetBtn');
    const sheetOutput = document.getElementById('sheetOutput');

    const columnsInput = document.getElementById('columns');
    const gapInput = document.getElementById('gap');
    const minWidthInput = document.getElementById('minWidth');
    const columnsValue = document.getElementById('columnsValue');
    const gapValue = document.getElementById('gapValue');
    const minWidthValue = document.getElementById('minWidthValue');
    const generateGridBtn = document.getElementById('generateGridBtn');
    const previewGridBtn = document.getElementById('previewGridBtn');
    const gridOutput = document.getElementById('gridOutput');

    const generateCompleteBtn = document.getElementById('generateCompleteBtn');
    const exportBtn = document.getElementById('exportBtn');
    const completeOutput = document.getElementById('completeOutput');
    const previewArea = document.getElementById('previewArea');
    const previewContent = document.getElementById('previewContent');

    async function init() {
      try {
        await connector.init();
        console.log('IndexedDB initialized');
      } catch (error) {
        console.error('Failed to initialize:', error);
      }
    }

    loadSheetBtn.addEventListener('click', async () => {
      const url = sheetUrlInput.value.trim();
      const sheetName = sheetNameInput.value.trim() || 'Sheet1';

      if (!url) {
        showError(sheetOutput, '请输入 Google Sheets URL');
        return;
      }

      try {
        loadSheetBtn.disabled = true;
        showOutput(sheetOutput, '正在加载数据...');

        const result = await connector.loadSheetData(url, sheetName, {
          useCache: true,
          cacheTimeout: 5 * 60 * 1000,
          showWarnings: true
        });

        sheetData = result.data;
        showSuccess(sheetOutput, `成功加载 ${sheetData.length} 条数据\n\n${JSON.stringify(sheetData, null, 2)}`);
      } catch (error) {
        showError(sheetOutput, `加载失败: ${error.message}`);
      } finally {
        loadSheetBtn.disabled = false;
      }
    });

    function updateSliderValues() {
      columnsValue.textContent = columnsInput.value;
      gapValue.textContent = gapInput.value;
      minWidthValue.textContent = minWidthInput.value;
    }

    columnsInput.addEventListener('input', updateSliderValues);
    gapInput.addEventListener('input', updateSliderValues);
    minWidthInput.addEventListener('input', updateSliderValues);

    generateGridBtn.addEventListener('click', () => {
      const config = {
        columns: parseInt(columnsInput.value),
        gap: parseInt(gapInput.value),
        minWidth: parseInt(minWidthInput.value),
        containerClass: '.grid-container'
      };

      const css = grid.generateFullGridCSS(config);
      showOutput(gridOutput, css);
    });

    previewGridBtn.addEventListener('click', () => {
      const config = {
        columns: parseInt(columnsInput.value),
        gap: parseInt(gapInput.value),
        minWidth: parseInt(minWidthInput.value),
        containerClass: 'grid-container'
      };

      const items = sheetData || [];
      const html = grid.previewGrid(config, items);

      previewArea.style.display = 'block';
      previewContent.innerHTML = html;
      showOutput(gridOutput, '预览已生成，查看下方实时预览区域');
    });

    generateCompleteBtn.addEventListener('click', () => {
      const config = {
        columns: parseInt(columnsInput.value),
        gap: parseInt(gapInput.value),
        minWidth: parseInt(minWidthInput.value),
        containerClass: '.grid-container',
        cardVariables: {
          '--card-bg': '#ffffff',
          '--card-text': '#1f2937',
          '--card-border': '#e5e7eb',
          '--card-shadow': '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
          '--card-radius': '12px',
          '--card-padding': '1.5rem'
        }
      };

      const items = sheetData || [];
      const html = grid.exportToHTML(config, items, { standalone: true, includeStyles: true });

      previewArea.style.display = 'block';
      previewContent.innerHTML = html;
      showOutput(completeOutput, '完整 HTML 已生成，查看下方预览区域');
    });

    exportBtn.addEventListener('click', () => {
      const config = {
        columns: parseInt(columnsInput.value),
        gap: parseInt(gapInput.value),
        minWidth: parseInt(minWidthInput.value),
        containerClass: '.grid-container',
        cardVariables: {
          '--card-bg': '#ffffff',
          '--card-text': '#1f2937',
          '--card-border': '#e5e7eb',
          '--card-shadow': '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
          '--card-radius': '12px',
          '--card-padding': '1.5rem'
        }
      };

      const items = sheetData || [];
      const html = grid.exportToHTML(config, items, { standalone: true, includeStyles: true });

      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'aura-canvas-grid.html';
      a.click();
      URL.revokeObjectURL(url);

      showSuccess(completeOutput, 'HTML 文件已导出');
    });

    function showOutput(element, content) {
      element.innerHTML = `<pre>${escapeHtml(content)}</pre>`;
    }

    function showError(element, message) {
      element.innerHTML = `<div class="error">${escapeHtml(message)}</div>`;
    }

    function showSuccess(element, message) {
      element.innerHTML = `<div class="success">${escapeHtml(message)}</div>`;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    init();
  </script>
</body>
</html>
